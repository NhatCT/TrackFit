<!doctype html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/springsecurity6">
<head>
  <meta charset="utf-8">
  <title th:text="${pageTitle} ?: 'Thông báo'">Thông báo</title>
  <th:block th:replace="~{fragments :: resources}"></th:block>
</head>
<body th:attr="data-user-id=${#authentication?.name}">

<nav th:replace="~{fragments :: header}"></nav>

<main class="container py-4">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h3 class="m-0">Thông báo</h3>
    <div th:if="${msg}" class="alert alert-success py-1 px-2 mb-0" th:text="${msg}"></div>
  </div>

  <!-- Bộ lọc -->
  <form method="get" class="row g-2 mb-3">
    <div class="col-md-5">
      <input class="form-control" name="kw" placeholder="Tìm nội dung/nguồn…"
             th:value="${kw}">
    </div>
    <div class="col-md-3">
      <select class="form-select" name="isRead">
        <option th:selected="${isRead == null}" value="">Tất cả</option>
        <option th:selected="${isRead == false}" value="false">Chưa đọc</option>
        <option th:selected="${isRead == true}" value="true">Đã đọc</option>
      </select>
    </div>
    <div class="col-md-2">
      <select class="form-select" name="type">
        <option th:selected="${type == null or type == ''}" value="">Mọi loại</option>
        <option th:selected="${type == 'SYSTEM'}" value="SYSTEM">SYSTEM</option>
        <option th:selected="${type == 'ADVICE'}" value="ADVICE">ADVICE</option>
        <option th:selected="${type == 'REMINDER'}" value="REMINDER">REMINDER</option>
      </select>
    </div>
    <div class="col-md-2 d-grid">
      <button class="btn btn-outline-primary">Lọc</button>
    </div>
  </form>

  <div class="table-responsive">
    <table class="table table-hover align-middle">
      <thead class="table-light">
      <tr>
        <th style="width:100px">ID</th>
        <th>Tiêu đề</th>
        <th>Nội dung</th>
        <th style="width:120px">Đọc</th>
        <th style="width:220px" class="text-end"></th>
      </tr>
      </thead>
      <tbody>
      <tr th:if="${#lists.isEmpty(items)}">
        <td colspan="5" class="text-center text-muted">Không có thông báo</td>
      </tr>
      <tr th:each="n : ${items}">
        <td th:text="${n.notificationId}">1</td>
        <td th:text="${n.title}">Tiêu đề</td>
        <td th:text="${n.content}">Nội dung</td>
        <td>
          <span th:text="${n.read} ? '✔' : '✖'">✖</span>
        </td>
        <td class="text-end">
          <form th:action="@{|/notifications/${n.notificationId}/read|}" method="post" class="d-inline">
            <input type="hidden" name="value" th:value="${!n.read}">
            <button class="btn btn-sm btn-outline-secondary"
                    th:text="${n.read} ? 'Đánh dấu chưa đọc' : 'Đánh dấu đã đọc'"></button>
          </form>
          <form th:action="@{|/notifications/${n.notificationId}/delete|}" method="post" class="d-inline"
                onsubmit="return confirm('Xóa thông báo này?')">
            <button class="btn btn-sm btn-outline-danger">Xóa</button>
          </form>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

</main>

<footer th:replace="~{fragments :: footer}"></footer>

<!-- (Nếu bạn đã gắn WebSocket ở fragments, không cần thêm gì ở đây) -->

</body>
</html>
